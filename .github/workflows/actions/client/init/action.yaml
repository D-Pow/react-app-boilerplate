name: Client - Initialize
description: Initializes the front-end


defaults:
  run:
    shell: bash


env:
  client-cache-name: client-cache


outputs:
  CLIENT_CACHE_ID:
    description: Client cache ID to use for all workflows/actions.
    value: ${{ steps.client-init-set-cache-id.outputs.CLIENT_CACHE_ID }}


runs:
  using: composite
  steps:
    - name: Client set cache ID
      id: client-init-set-cache-id
      shell: bash
      run: |
        echo "CLIENT_CACHE_ID=${{ env.client-cache-name }}-${{ runner.os }}-${{ hashFiles('./package.json', './src/**', './test/**', './tests/**', './config/**', './mocks/**') }}" >> $GITHUB_ENV
        echo "CLIENT_CACHE_ID=${{ env.CLIENT_CACHE_ID }}" >> $GITHUB_OUTPUT

    - name: Client Install
      id: client-install
      shell: bash
      run: |
        npm install

    - name: Client - Cache init artifacts
      id: client-init-cache
      uses: actions/cache/save@v3
      with:
        path: |
          node_modules
          dist
          package.json
          package-lock.json
        # key: ${{ env.client-cache-name }}-${{ runner.os }}-${{ hashFiles('./src/**', './tests/**', './mocks/**', './config/**', './scripts/**', './.github/**') }}
        key: ${{ env.client-cache-name }}-${{ runner.os }}-${{ hashFiles('./src/**', './test/**', './tests/**', './config/**', './mocks/**') }}
        # restore-keys: |
        #   ${{ env.client-cache-name }}-${{ runner.os }}-
        #   ${{ env.client-cache-name }}-

    - name: Read client cache ID
      shell: bash
      run: |
        echo "${{ steps.client-init-cache.outputs }}"
        echo "$CLIENT_CACHE_ID -- ${{ env.CLIENT_CACHE_ID }}"
